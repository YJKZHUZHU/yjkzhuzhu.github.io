## è®¾è®¡æ¨¡å¼

### ç­–ç•¥æ¨¡å¼(è¡Œä¸ºæ¨¡å¼)

> å®šä¹‰ä¸€ç³»åˆ—çš„ç®—æ³•ï¼ŒæŠŠå®ƒä»¬ä¸€ä¸ªä¸ªå°è£…èµ·æ¥ï¼Œå¹¶ä¸”ä½¿å®ƒä»¬å¯ä»¥ç›¸äº’æ›¿æ¢ã€‚æœ¬æ¨¡å¼ä½¿å¾—ç®—æ³•å¯ä»¥ç‹¬ç«‹äºä½¿ç”¨å®ƒçš„å®¢æˆ·è€Œå˜åŒ–ã€‚

ç­–ç•¥æ˜¯ä¸ªå½¢è±¡çš„è¡¨è¿°ï¼Œæ‰€è°“ç­–ç•¥å°±æ˜¯æ–¹æ¡ˆï¼Œæˆ‘ä»¬éƒ½çŸ¥é“ä»»ä½•äº‹æƒ…éƒ½æœ‰å¤šç§æ–¹æ¡ˆï¼Œè€Œä¸”ä¸åŒæ–¹æ¡ˆéƒ½èƒ½è§£å†³é—®é¢˜ï¼Œæ‰€ä»¥è¿™äº›æ–¹æ¡ˆå¯ä»¥ç›¸äº’æ›¿æ¢ã€‚æˆ‘ä»¬å°†æ–¹æ¡ˆä»é—®é¢˜ä¸­æŠ½è±¡å‡ºæ¥ï¼Œè¿™æ ·å°±å¯ä»¥æŠ›å¼€é—®é¢˜ï¼Œå•ç‹¬ä¼˜åŒ–æ–¹æ¡ˆäº†ï¼Œè¿™å°±æ˜¯ç­–ç•¥æ¨¡å¼çš„æ ¸å¿ƒæ€æƒ³ã€‚

#### ä¸€äº›ä¾‹å­

- åœ°å›¾å¯¼èˆªï¼šæˆ‘ä»¬å»ä»»ä½•åœ°æ–¹éƒ½å¯ä»¥é€‰æ‹©æ­¥è¡Œã€éª‘è½¦ã€å¼€è½¦ã€å…¬äº¤ï¼Œä¸åŒçš„æ–¹æ¡ˆéƒ½å¯ä»¥å¸®åŠ©æˆ‘ä»¬åˆ°è¾¾ç›®çš„åœ°ï¼Œé‚£ä¹ˆå¾ˆæ˜æ˜¾åº”è¯¥å°†è¿™äº›æ–¹æ¡ˆå˜æˆç­–ç•¥å°è£…èµ·æ¥ï¼Œæ¥æ”¶çš„éƒ½æ˜¯å‡ºå‘ç‚¹å’Œç›®çš„åœ°ï¼Œè¾“å‡ºçš„éƒ½æ˜¯è·¯çº¿ã€‚
- å¸ƒå±€æ–¹å¼ï¼šæ¯”å¦‚æˆ‘ä»¬åšä¸€ä¸ªæŠ¥è¡¨ç³»ç»Ÿï¼Œåœ¨ PC ä½¿ç”¨çŠæ ¼å¸ƒå±€ï¼Œåœ¨ç§»åŠ¨ç«¯ä½¿ç”¨æµå¼å¸ƒå±€ï¼Œå…¶å®å†…å®¹è¿˜æ˜¯é‚£äº›ï¼Œåªæ˜¯å¸ƒå±€æ–¹å¼ä¼šéšç€ä¸åŒç»ˆç«¯å¤§å°åšä¸åŒçš„é€‚é…ï¼Œé‚£ä¹ˆå¸ƒå±€çš„é€‚é…å°±æ˜¯ä¸€ç§ç­–ç•¥ï¼Œå®ƒå¯ä»¥ä¸æŠ¥è¡¨å†…å®¹æ— å…³ã€‚æˆ‘ä»¬å¯ä»¥å°†å¸ƒå±€ç­–ç•¥å•ç‹¬æŠ½å–å‡ºæ¥ï¼Œä»¥åç”šè‡³å¯ä»¥é€‚é…ç”µè§†æœºã€æŠ•å½±ä»ªç­‰ç­‰ä¸åŒå°ºå¯¸çš„åœºæ™¯ï¼Œè€Œä¸éœ€è¦å¯¹å…¶ä»–ä»£ç åšä»»ä½•æ”¹åŠ¨ï¼Œè¿™å°±æ˜¯å°†å¸ƒå±€ç­–ç•¥ä»ä»£ç ä¸­è§£è€¦å‡ºæ¥çš„å¥½å¤„ã€‚
- sort æ’åºç®—æ³•ï¼šå½“æˆ‘ä»¬è°ƒç”¨ .sort æ—¶ï¼Œä½¿ç”¨çš„æ˜¯ä»€ä¹ˆæ’åºç®—æ³•ï¼Ÿå¯èƒ½æ˜¯å†’æ³¡ã€å¿«é€Ÿã€æ’å…¥æ’åºï¼Ÿå…¶å®æ— è®ºä½•ç§æ’åºç®—æ³•ï¼Œæœ¬è´¨ä¸Šåšçš„äº‹æƒ…éƒ½æ˜¯ä¸€æ ·çš„ï¼Œæˆ‘ä»¬å¯ä»¥äº‹å…ˆå°†æ’åºç®—æ³•å°è£…èµ·æ¥ï¼Œé’ˆå¯¹ä¸åŒç‰¹æ€§çš„æ•°ç»„è°ƒç”¨ä¸åŒçš„æ’åºç®—æ³•ã€‚

#### å®æˆ˜

> æ ¹æ®ä¸åŒèŒƒå›´å€¼æ˜¾ç¤ºä¸åŒçš„èˆ’é€‚å€¼æ–‡æ¡ˆ

- å¸¸è§„æ€è·¯ if else ä¸€æŠŠæ¢­

  ```typescript
  const parseTempLevel = (tempValue: number, tempUnit: string) => {
    const level = tempUnit === 'â„‰' ? [39.2, 64.4, 82.4, 98.6] : [4, 18, 28, 37];
    let status: TempLevelProps;
    if (tempValue <= level[0]) {
      status = TempLevelProps.veryCold;
    } else if (tempValue <= level[1]) {
      status = TempLevelProps.cold;
    } else if (tempValue <= level[2]) {
      status = TempLevelProps.comfortable;
    } else if (tempValue <= level[3]) {
      status = TempLevelProps.hot;
    } else {
      status = TempLevelProps.veryHot;
    }
    return status;
  };
  ```

- ç­–ç•¥æ¨¡å¼

  ```typescript
  class Validator {
    constructor(value: number, level: number[]) {
      this.val = value;
      this.level = level;
    }

    level: number[];

    val: number;

    cache: (() => void)[] = [];
    // ç­–ç•¥
    strategies: TypeStrategies = {
      veryCold: () => {
        return this.val <= this.level[0] && TempLevelProps.veryCold;
      },
      cold: () => {
        return (
          this.val <= this.level[1] &&
          this.val > this.level[0] &&
          TempLevelProps.cold
        );
      },
      comfortableByTemp: () => {
        return (
          this.val <= this.level[2] &&
          this.val > this.level[1] &&
          TempLevelProps.comfortable
        );
      },
      hot: () => {
        return (
          this.val <= this.level[3] &&
          this.val > this.level[2] &&
          TempLevelProps.hot
        );
      },
      veryHot: () => {
        return this.val > this.level[3] && TempLevelProps.veryHot;
      },
      veryDry: () => {
        return this.val <= this.level[0] && HumLevelProps.veryDry;
      },
      dry: () => {
        return (
          this.val <= this.level[1] &&
          this.val > this.level[0] &&
          HumLevelProps.dry
        );
      },
      comfortableByHumid: () => {
        return (
          this.val <= this.level[2] &&
          this.val > this.level[1] &&
          HumLevelProps.comfortable
        );
      },
      damp: () => {
        return (
          this.val > this.level[2] &&
          this.val <= this.level[3] &&
          HumLevelProps.damp
        );
      },
      veryDamp: () => {
        return this.val > this.level[3] && HumLevelProps.veryDamp;
      },
    };

    // æ·»åŠ ç­–ç•¥äº‹ä»¶
    add = function(method: TypeLevel) {
      this?.cache?.push(
        (method => {
          return this.strategies[method]();
        })(method),
      );
    };
    // æ ¡éªŒç­–ç•¥
    check = function() {
      return this?.cache?.find(Boolean);
    };
  }
  ```

  ä½¿ç”¨

  ```typescript
  export const parseTempLevel = (tempValue: number, tempUnit: string) => {
    const level = tempUnit === 'â„‰' ? [39.2, 64.4, 82.4, 98.6] : [4, 18, 28, 37];
    const validator = new Validator(tempValue, level);
    validator.add('cold'); // ç­–ç•¥1
    validator.add('comfortableByTemp'); // ç­–ç•¥2
    validator.add('hot'); // ç­–ç•¥3
    validator.add('veryCold'); // ç­–ç•¥4
    validator.add('veryHot'); // ç­–ç•¥5
    return validator.check();
  };
  ```

  è¿™æ˜¯ä¸æ˜¯æ¯”ä¸€ç›´ç–¯ç‹‚å†™ if-else å¥½å¤ªå¤šäº†å‘¢ï¼Ÿè¿˜æœ‰ä»€ä¹ˆä¾‹å­ï¼Ÿè¡¨å•éªŒè¯å•Š ~ å¯¹äºè¡¨å•å­—æ®µï¼ˆåç§°ã€å¯†ç ã€é‚®ç®±ã€....ï¼‰æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç­–ç•¥æ¨¡å¼å»è®¾è®¡ä¼˜åŒ–å®ƒï¼Œæƒ³å•¥å‘¢ï¼Œèµ¶ç´§åŠ¨æ‰‹è¯•ä¸€ä¸‹ï¼æˆ‘éƒ½å·²ç»æ‰‹æŠŠæ‰‹æ•™ä½ åˆ°è¿™äº†~

#### ä»€ä¹ˆæ—¶å€™ä½¿ç”¨

- å„åˆ¤æ–­æ¡ä»¶ä¸‹çš„ç­–ç•¥ç›¸äº’ç‹¬ç«‹ä¸”å¯å¤ç”¨
- ç­–ç•¥éœ€è¦çµæ´»ç»„åˆ
- ç­–ç•¥å†…éƒ¨é€»è¾‘ç›¸å¯¹å¤æ‚

#### å¼Šç«¯

ä¸è¦èµ°æç«¯ï¼Œä¸è¦æ¯ä¸ªåˆ†æ”¯èµ°ä¸€ä¸ªç­–ç•¥æ¨¡å¼ï¼Œè¿™æ ·ä¼šå¯¼è‡´ç­–ç•¥ç±»è¿‡å¤šã€‚å½“åˆ†æ”¯é€»è¾‘ç®€å•æ¸…æ™°å¥½ç»´æŠ¤æ—¶ï¼Œä¸éœ€è¦ä½¿ç”¨ç­–ç•¥æ¨¡å¼æŠ½è±¡ã€‚

### è£…é¥°å™¨æ¨¡å¼

> åŠ¨æ€åœ°ç»™ä¸€ä¸ªå¯¹è±¡æ·»åŠ ä¸€äº›é¢å¤–çš„èŒè´£**ã€‚**æ˜¯ä¸ºäº†ç»™ä¸€ä¸ªå‡½æ•°èµ‹èƒ½ï¼Œå¢å¼ºå®ƒçš„æŸç§èƒ½åŠ›ï¼Œå®ƒèƒ½åŠ¨æ€çš„æ·»åŠ å¯¹è±¡çš„è¡Œä¸ºï¼Œä¹Ÿå°±æ˜¯æˆ‘ä¼ å…¥çš„å°±æ˜¯ä¸€ä¸ªå¯¹è±¡ã€‚æ¯•ç«Ÿåœ¨ JS çš„ä¸–ç•Œä¸­ä¸‡ç‰©çš†å¯¹è±¡ã€‚å¦‚å¤©å†·äº†å¤šç©¿è¡£æœï¼Œé‡‘å¸è¶³å¤Ÿäº†æ¢å¤æ´»ç”²

#### ä¸€äº›ä¾‹å­

- é«˜é˜¶å‡½æ•°ï¼Œé«˜é˜¶ç»„ä»¶
- è£…é¥°å‡½æ•°
- AOP è£…é¥°å‡½æ•°

#### å®æˆ˜

- é«˜é˜¶ç»„ä»¶

  ```typescript
  import React from 'react';

  const WithWrapperHOC = (WrapperComponent: any) => {
    return class extends React.Component {
      render() {
        return (
          <div style={{ backgroundColor: 'yellow' }}>
            <WrapperComponent {...this.props} />
          </div>
        );
      }
    };
  };

  const Wrapper = () => {
    return (
      <div>
        <p>æˆ‘å˜é¢œè‰²äº†</p>
      </div>
    );
  };

  export default WithWrapperHOC(Wrapper);
  ```

- ä¸¾ä¸ªæµ…æ˜¾çš„ ğŸŒ°ã€‚

  ```typescript
  class MyFunc {
    react = function() {
      console.log('æˆ‘ä¼šreact');
    };
  }

  class Decorator {
    constructor(old: () => void) {
      this.oldFunc = old;
    }
    oldFunc: () => void;
    vue = () => {
      console.log('æˆ‘ä¼švue');
    };
    compose = () => {
      this.oldFunc();
      this.vue();
    };
  }

  const myFunc = new MyFunc();
  const decorator = new Decorator(myFunc.react);

  decorator.compose();
  ```

- è£…é¥°å‡½æ•°

  ```typescript
  const func = () => {
    console.log(11);
  };

  // æ”¹æˆ
  const func = () => {
    console.log(11);
    console.log(22);
  };
  ```

  å¾ˆå¤šæ—¶å€™æˆ‘ä»¬ä¸æƒ³å»ç¢°åŸå‡½æ•°ï¼Œä¹Ÿè®¸åŸå‡½æ•°æ˜¯ç”±å…¶ä»–åŒäº‹ç¼–å†™çš„ï¼Œé‡Œé¢çš„å®ç°éå¸¸æ‚ä¹±ã€‚ç”šè‡³åœ¨ä¸€ä¸ªå¤è€çš„é¡¹ç›®ä¸­ï¼Œè¿™ä¸ªå‡½æ•°çš„æºä»£ç è¢«éšè—åœ¨ä¸€ä¸ªæˆ‘ä»¬ä¸æ„¿ç¢°è§¦çš„é˜´æš—è§’è½é‡Œã€‚é‚£æœ‰æ²¡æœ‰åœ¨ä¸æ”¹å˜å‡½æ•°æºä»£ç çš„æƒ…å†µä¸‹ï¼Œèƒ½ç»™å‡½æ•°å¢åŠ åŠŸèƒ½ï¼Œç­”æ¡ˆæ˜¯æœ‰çš„ã€‚

  æˆ‘ä»¬å¯ä»¥ä¿å­˜åŸå¼•ç”¨æ¥æ”¹å†™æŸä¸ªå‡½æ•°

  ```typescript
  let func = () => {
    console.log(11);
  };
  const _func = func;
  // æ”¹æˆ
  let func = () => {
    _func();
    console.log(22);
  };
  ```

  è¿™æ ·è™½ç„¶éµå¾ªäº†å°é—­-å¼€æ”¾åŸåˆ™ï¼Œä½†æ˜¯ä¹Ÿå¼•å‘äº†å…¶ä»–çš„é—®é¢˜ï¼Œ

  1. éœ€è¦ç»´æŠ¤\_func è¿™ä¸ªå˜é‡ï¼Œä½†å¦‚æœå‡½æ•°çš„è£…é¥°é“¾è¾ƒé•¿ï¼Œæˆ–è€…éœ€è¦è£…é¥°çš„å‡½æ•°å˜å¤šï¼Œè¿™äº›ä¸­é—´å˜é‡çš„æ•°é‡ä¹Ÿä¼šè¶Šæ¥è¶Šå¤šã€‚
  2. this åŠ«æŒé—®é¢˜ï¼Œå› æ­¤æ”¹æ–¹å¼ä¹Ÿä¸æ˜¯å¾ˆä¿é™©ï¼Œä¹Ÿæ˜¯èƒ½è§£å†³çš„é€šè¿‡ callï¼Œapply,bind ç­‰æ‰‹æ®µï¼Œæ¥æ”¹å˜ this æŒ‡å‘

- AOP è£…é¥°å‡½æ•°

  ```typescript
  Function.prototype.before = function(beforefn) {
    var __self = this; // ä¿å­˜åŸå‡½æ•°çš„å¼•ç”¨
    return function() {
      // è¿”å›åŒ…å«äº†åŸå‡½æ•°å’Œæ–°å‡½æ•°çš„"ä»£ç†"å‡½æ•°
      beforefn.apply(this, arguments); // æ‰§è¡Œæ–°å‡½æ•°ï¼Œä¸”ä¿è¯ this ä¸è¢«åŠ«æŒï¼Œæ–°å‡½æ•°æ¥å—çš„å‚æ•°
      // ä¹Ÿä¼šè¢«åŸå°ä¸åŠ¨åœ°ä¼ å…¥åŸå‡½æ•°ï¼Œæ–°å‡½æ•°åœ¨åŸå‡½æ•°ä¹‹å‰æ‰§è¡Œ
      return __self.apply(this, arguments); // æ‰§è¡ŒåŸå‡½æ•°å¹¶è¿”å›åŸå‡½æ•°çš„æ‰§è¡Œç»“æœï¼Œ
      // å¹¶ä¸”ä¿è¯ this ä¸è¢«åŠ«æŒ
    };
  };
  Function.prototype.after = function(afterfn) {
    var __self = this;
    return function() {
      var ret = __self.apply(this, arguments);
      afterfn.apply(this, arguments);
      return ret;
    };
  };
  ```

  Function.prototype.before æ¥å—ä¸€ä¸ªå‡½æ•°å½“ä½œå‚æ•°ï¼Œè¿™ä¸ªå‡½æ•°å³ä¸ºæ–°æ·»åŠ çš„å‡½æ•°ï¼Œå®ƒè£…è½½äº†æ–°æ·»åŠ çš„åŠŸèƒ½ä»£ç ã€‚æ¥ä¸‹æ¥æŠŠå½“å‰çš„ this ä¿å­˜èµ·æ¥ï¼Œè¿™ä¸ª this æŒ‡å‘åŸå‡½æ•°ï¼Œç„¶åè¿”å›ä¸€ä¸ªâ€œä»£ç†â€å‡½æ•°ï¼Œè¿™ä¸ªâ€œä»£ç†â€å‡½æ•°åªæ˜¯ç»“æ„ä¸Šåƒä»£ç†è€Œå·²ï¼Œå¹¶ä¸æ‰¿æ‹…ä»£ç†çš„èŒè´£ï¼ˆæ¯”å¦‚æ§åˆ¶å¯¹è±¡çš„è®¿é—®ç­‰ï¼‰ã€‚å®ƒçš„å·¥ä½œæ˜¯æŠŠè¯·æ±‚åˆ†åˆ«è½¬å‘ç»™æ–°æ·»åŠ çš„å‡½æ•°å’ŒåŸå‡½æ•°ï¼Œä¸”è´Ÿè´£ä¿è¯å®ƒä»¬çš„æ‰§è¡Œé¡ºåºï¼Œè®©æ–°æ·»åŠ çš„å‡½æ•°åœ¨åŸå‡½æ•°ä¹‹å‰æ‰§è¡Œï¼ˆå‰ç½®è£…é¥°ï¼‰ï¼Œè¿™æ ·å°±å®ç°äº†åŠ¨æ€è£…é¥°çš„æ•ˆæœã€‚æˆ‘ä»¬æ³¨æ„åˆ°ï¼Œé€šè¿‡ Function.prototype.apply æ¥åŠ¨æ€ä¼ å…¥æ­£ç¡®çš„ thisï¼Œä¿è¯äº†å‡½æ•°åœ¨è¢«è£…é¥°ä¹‹åï¼Œthis ä¸ä¼šè¢«åŠ«æŒã€‚

  Function.prototype.after çš„åŸç†è·Ÿ Function.prototype.before ä¸€æ¨¡ä¸€æ ·ï¼Œå”¯ä¸€ä¸åŒçš„åœ°æ–¹åœ¨äºè®©æ–°æ·»åŠ çš„å‡½æ•°åœ¨åŸå‡½æ•°æ‰§è¡Œä¹‹åå†æ‰§è¡Œã€‚

  - AOP å‡½æ•°çš„åº”ç”¨

    1. æ•°æ®ç»Ÿè®¡ä¸ŠæŠ¥

       ```typescript
       Function.prototype.after = function(afterFn: Function) {
         const __self = this;
         return () => {
           const ret = __self.apply(this, arguments);
           afterFn.apply(this, arguments);
           return ret;
         };
       };

       const log = () => {
         console.log('ä¸ŠæŠ¥æ ‡ç­¾ä¸º: ' + 'button');
       };

       const Wrapper = () => {
         const onReport = () => {
           console.log('ç‚¹å‡»äº†æŒ‰é’®');
         };

         return (
           <div>
             <button onClick={onReport.after(log)}>ç‚¹æˆ‘ä¸ŠæŠ¥</button>
           </div>
         );
       };

       export default Wrapper;
       ```

       è¿™æ ·å°±å®ç°äº†ä¸šåŠ¡ä¸ä¸ŠæŠ¥è§£è€¦ï¼Œå½“ç„¶æ˜¯ä¸å¤ªå»ºè®®ç›´æ¥åœ¨åŸå‹ä¸Šæ–°å¢æ–¹æ³•çš„ï¼Œå¯ä»¥è‡ªå·±å®ç°ä¸€ä¸ªæ„é€ å‡½æ•°ã€‚

    2. AOP åŠ¨æ€æ”¹å˜å‡½æ•°å‚æ•°

       å…ˆæ¥å®ç°ä¸€ä¸ª before å‡½æ•°

       ```typescript
       Function.prototype.before = function(beforefn: Function) {
         const __self = this;
         return function() {
           // è¿™é‡Œä¸èƒ½ä½¿ç”¨ç®­å¤´å‡½æ•°
           // é¡ºåºä¸è¦ä¹±äº†
           beforefn.apply(this, arguments); // (1)
           return __self.apply(this, arguments); // (2)
         };
       };

       const Wrapper = () => {
         var onFetch = (params: any) => {
           console.log(params); // è¾“å‡ºï¼š {a: "a", b: "b"}
         };

         const d = onFetch.before((params: any) => {
           console.log('params=', params);
           params.b = 'b';
         });

         return (
           <div>
             <button onClick={() => d({ a: 'a' })}>å‘è¯·æ±‚</button>
           </div>
         );
       };

       export default WithWrapperHOC(Wrapper);
       ```

       beforefn å’ŒåŸå‡½æ•°**self å…±ç”¨ä¸€ç»„å‚æ•°åˆ—è¡¨ argumentsï¼Œå½“æˆ‘ä»¬åœ¨ beforefn çš„å‡½æ•°ä½“å†…æ”¹å˜ arguments çš„æ—¶å€™ï¼ŒåŸå‡½æ•°**self æ¥æ”¶çš„å‚æ•°åˆ—è¡¨è‡ªç„¶ä¹Ÿä¼šå˜åŒ–ã€‚

       å†æ¥ä¸€ä¸ªåœºæ™¯ï¼Œç»™ ajax åŠ¨æ€æ–°å¢å‚æ•°ï¼ŒåŠ è®¾æœ‰è¿™ä¹ˆä¸€ä¸ªåœºæ™¯ï¼Œæœ‰ä¸€å¤©ç½‘ç«™å—åˆ°äº† CSRF æ”»å‡»ï¼Œåç«¯è¯´éœ€è¦åœ¨æ¯ä¸ªæ¥å£å‚æ•°ä¸­æ–°å¢ä¸€ä¸ª token å‚æ•°æ ¡éªŒã€‚

       å¸¸è§„åˆ™æ€è·¯æ˜¯å¤§æ¦‚æ˜¯è¿™æ ·

       ```typescript
       // è¿™æ˜¯ä¸€ä¸ªè·å–tokençš„å‚æ•°
       const getToken = function() {
         return 'Token';
       };
       // å‘é€ajax
       const ajax = function(type, url, param) {
         param = param || {};
         Param.Token = getToken(); // å‘é€ ajax è¯·æ±‚çš„ä»£ç ç•¥...
       };
       ```

       è™½ç„¶å·²ç»è§£å†³äº†é—®é¢˜ï¼Œä½†æˆ‘ä»¬çš„ ajax å‡½æ•°ç›¸å¯¹å˜å¾—åƒµç¡¬äº†ï¼Œæ¯ä¸ªä» ajax å‡½æ•°é‡Œå‘å‡ºçš„è¯·æ±‚éƒ½è‡ªåŠ¨å¸¦ä¸Šäº† Token å‚æ•°ï¼Œè™½ç„¶åœ¨ç°åœ¨çš„é¡¹ç›®ä¸­æ²¡æœ‰ä»€ä¹ˆé—®é¢˜ï¼Œä½†å¦‚æœå°†æ¥æŠŠè¿™ä¸ªå‡½æ•°ç§»æ¤åˆ°å…¶ä»–é¡¹ç›®ä¸Šï¼Œæˆ–è€…æŠŠå®ƒæ”¾åˆ°ä¸€ä¸ªå¼€æºåº“ä¸­ä¾›å…¶ä»–äººä½¿ç”¨ï¼ŒToken å‚æ•°éƒ½å°†æ˜¯å¤šä½™çš„ã€‚ï¼ˆæ˜¯ä¸æ˜¯æ¯æ¬¡ copy ä»£ç ä»£ç è¿˜å¾—å¤šå¤šå°‘å°‘æ”¹ç‚¹ï¼‰

       â€‹ ä¹Ÿè®¸å¦ä¸€ä¸ªé¡¹ç›®ä¸éœ€è¦éªŒè¯ Tokenï¼Œæˆ–è€…æ˜¯ Token çš„ç”Ÿæˆæ–¹å¼ä¸åŒï¼Œæ— è®ºæ˜¯å“ªç§æƒ…å†µï¼Œéƒ½å¿…é¡»é‡æ–°ä¿®æ”¹ ajax å‡½æ•°ã€‚

       â€‹ ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå…ˆæŠŠ ajax å‡½æ•°è¿˜åŸæˆä¸€ä¸ªå¹²å‡€çš„å‡½æ•°ï¼š

       ```typescript
       const ajax= function( type, url, param ){
        console.log(param); // å‘é€ ajax è¯·æ±‚çš„ä»£ç ç•¥
       };
       // ç„¶åæŠŠ Token å‚æ•°é€šè¿‡ Function.prototyte.before è£…é¥°åˆ° ajax å‡½æ•°çš„å‚æ•° param å¯¹è±¡ä¸­ï¼š
       var getToken = function(){
        return 'Token';
       }
       ajax = ajax.before(function( type, url, param ){
        param.Token = getToken();
       });
       ajax( 'get', 'http:// xxx.com/userinfo', { name: 'sven' } );
       // ä» ajax å‡½æ•°æ‰“å°çš„ log å¯ä»¥çœ‹åˆ°ï¼ŒToken å‚æ•°å·²ç»è¢«é™„åŠ åˆ°äº† ajax è¯·æ±‚çš„å‚æ•°ä¸­ï¼š
       {name: "sven", Token: "Token"}
       ```

       æ˜æ˜¾å¯ä»¥çœ‹åˆ°ï¼Œç”¨ AOP çš„æ–¹å¼ç»™ ajax å‡½æ•°åŠ¨æ€è£…é¥°ä¸Š Token å‚æ•°ï¼Œä¿è¯äº† ajax å‡½æ•°æ˜¯ä¸€ä¸ªç›¸å¯¹çº¯å‡€çš„å‡½æ•°ï¼Œæé«˜äº† ajax å‡½æ•°çš„å¯å¤ç”¨æ€§ï¼Œå®ƒåœ¨è¢«è¿å¾€å…¶ä»–é¡¹ç›®çš„æ—¶å€™ï¼Œä¸éœ€è¦åšä»»ä½•ä¿®æ”¹ã€‚

       - æ’ä»¶è¯•çš„è¡¨å•æ ¡éªŒ

         web ç«¯ä¸­ï¼Œè¡¨å•æ ¡éªŒå¾ˆå¸¸è§ï¼Œé€šå¸¸ä¸€ä¸ªæäº¤æ“ä½œéœ€è¦æ ¡éªŒè¡¨å•ï¼Œå‘èµ·è¯·æ±‚

         æœ€å¸¸è§çš„ä»£ç ï¼Œèƒ½çœ‹åˆ°æ ¡éªŒå’Œæäº¤éƒ½æ”¾åœ¨ä¸€èµ·äº†ï¼ŒformSubmit å‡½æ•°åœ¨æ­¤å¤„æ‰¿æ‹…äº†ä¸¤ä¸ªèŒè´£ï¼Œé™¤äº†æäº¤ ajax è¯·æ±‚ä¹‹å¤–ï¼Œè¿˜è¦éªŒè¯ç”¨æˆ·è¾“å…¥çš„åˆæ³•æ€§ã€‚è¿™ç§ä»£ç ä¸€æ¥ä¼šé€ æˆå‡½æ•°è‡ƒè‚¿ï¼ŒèŒè´£æ··ä¹±ï¼ŒäºŒæ¥è°ˆä¸ä¸Šä»»ä½•å¯å¤ç”¨æ€§

         ```typescript
         const formSubmit = function() {
           // è¡¨å•æ ¡éªŒ
           if (username.value === '') {
             return alert('ç”¨æˆ·åä¸èƒ½ä¸ºç©º');
           }
           if (password.value === '') {
             return alert('å¯†ç ä¸èƒ½ä¸ºç©º');
           }
           var param = {
             username: username.value,
             password: password.value,
           };
           // å‘èµ·è¯·æ±‚
           ajax('http:// xxx.com/login', param); // ajax å…·ä½“å®ç°ç•¥
         };
         submitBtn.onclick = function() {
           formSubmit();
         };
         ```

         æ¥ä¼˜åŒ–ä¸€ä¸‹ï¼Œæˆ‘ä»¬æŠŠæ ¡éªŒçš„é€»è¾‘éƒ½æ”¾åˆ°äº† validata å‡½æ•°ä¸­ï¼Œä½† formSubmit å‡½æ•°çš„å†…éƒ¨è¿˜è¦è®¡ç®— validata å‡½æ•°çš„è¿”å›å€¼ï¼Œå› ä¸ºè¿”å›å€¼çš„ç»“æœè¡¨æ˜äº†æ˜¯å¦é€šè¿‡æ ¡éªŒã€‚

         ```typescript
         const validate = () => {
           if (username.value === '') {
             alert('ç”¨æˆ·åä¸èƒ½ä¸ºç©º');
             return false;
           }
           if (password.value === '') {
             alert('å¯†ç ä¸èƒ½ä¸ºç©º');
             return false;
           }
         };

         const formSubmit = function() {
           if (!validate()) return false;
           // å‘èµ·è¯·æ±‚
           ajax('http:// xxx.com/login', param); // ajax å…·ä½“å®ç°ç•¥
         };

         submitBtn.onclick = function() {
           formSubmit();
         };
         ```

         å†æ¥ä¼˜åŒ–ä¸€ä¸‹ï¼Œä½¿ validata å’Œ formSubmit å®Œå…¨åˆ†ç¦»å¼€æ¥ï¼Œåœ¨è¿™æ®µä»£ç ä¸­ï¼Œæ ¡éªŒè¾“å…¥å’Œæäº¤è¡¨å•çš„ä»£ç å®Œå…¨åˆ†ç¦»å¼€æ¥ï¼Œå®ƒä»¬ä¸å†æœ‰ä»»ä½•è€¦åˆå…³ç³»ï¼ŒformSubmit = formSubmit.before( validata )è¿™å¥ä»£ç ï¼Œå¦‚åŒæŠŠæ ¡éªŒè§„åˆ™åŠ¨æ€æ¥åœ¨ formSubmit å‡½æ•°ä¹‹å‰ï¼Œvalidata æˆä¸ºä¸€ä¸ªå³æ’å³ç”¨çš„å‡½æ•°ï¼Œå®ƒç”šè‡³å¯ä»¥è¢«å†™æˆé…ç½®æ–‡ä»¶çš„å½¢å¼ï¼Œè¿™æœ‰åˆ©äºæˆ‘ä»¬åˆ†å¼€ç»´æŠ¤è¿™ä¸¤ä¸ªå‡½æ•°ã€‚å†åˆ©ç”¨ä¸Šé¢è¯´åˆ°çš„ç­–ç•¥æ¨¡å¼ç¨åŠ æ”¹é€ ï¼Œæˆ‘ä»¬å°±å¯ä»¥æŠŠè¿™äº›æ ¡éªŒè§„åˆ™éƒ½å†™æˆæ’ä»¶çš„å½¢å¼ï¼Œç”¨åœ¨ä¸åŒçš„é¡¹ç›®å½“ä¸­ã€‚

         ```typescript
         Function.prototype.before = function(beforefn) {
           var __self = this;
           return function() {
             if (beforefn.apply(this, arguments) === false) {
               // beforefn è¿”å› false çš„æƒ…å†µç›´æ¥ returnï¼Œä¸å†æ‰§è¡Œåé¢çš„åŸå‡½æ•°
               return;
             }
             return __self.apply(this, arguments);
           };
         };
         var validata = function() {
           if (username.value === '') {
             alert('ç”¨æˆ·åä¸èƒ½ä¸ºç©º');
             return false;
           }
           if (password.value === '') {
             alert('å¯†ç ä¸èƒ½ä¸ºç©º');
             return false;
           }
         };
         var formSubmit = function() {
           var param = {
             username: username.value,
             password: password.value,
           };
           ajax('http:// xxx.com/login', param);
         };
         formSubmit = formSubmit.before(validata);
         submitBtn.onclick = function() {
           formSubmit();
         };
         ```

#### å¼Šç«¯

- åŒ…è£…å™¨å±‚æ¬¡å¢å¤šï¼Œä¼šå¢åŠ è°ƒè¯•æˆæœ¬ï¼Œæˆ‘ä»¬æ¯”è¾ƒéš¾è¿½æº¯åˆ°ä¸€ä¸ª bug æ˜¯åœ¨å“ªä¸€å±‚åŒ…è£…å¯¼è‡´çš„ã€‚ï¼ˆæƒ³æƒ³é«˜é˜¶ç»„ä»¶çš„è°ƒè¯•ï¼‰

- ç»„åˆè¿‡ç¨‹çš„å¤æ‚ï¼Œè¦ç”Ÿæˆè¿‡å¤šçš„å¯¹è±¡ã€‚æ€§èƒ½ä¹Ÿä¼šæ”¶åˆ°å½±å“ã€‚å› ä¸ºå‡½æ•°é€šè¿‡ Function.prototype.before æˆ–è€… Function.prototype.after è¢«è£…é¥°ä¹‹åï¼Œè¿”å›çš„å®é™…ä¸Šæ˜¯ä¸€ä¸ªæ–°çš„å‡½æ•°ï¼Œå¦‚æœåœ¨åŸå‡½æ•°ä¸Šä¿å­˜äº†ä¸€äº›å±æ€§ï¼Œé‚£ä¹ˆè¿™äº›å±æ€§ä¼šä¸¢å¤±ã€‚ä»£ç å¦‚ä¸‹

  ```typescript
  const func = function() {
    alert(1);
  };
  func.a = 'a';
  func = func.after(function() {
    alert(2);
  });
  alert(func.a); // è¾“å‡ºï¼šundefined
  ```

### ä»£ç†æ¨¡å¼

> ä»£ç†æ¨¡å¼æ˜¯ä¸ºå…¶å®ƒå¯¹è±¡æä¾›ä¸€ç§ä»£ç†ä»¥**æ§åˆ¶**è¿™ä¸ªå¯¹è±¡çš„è®¿é—®ï¼Œå…·ä½“æ‰§è¡Œçš„åŠŸèƒ½è¿˜æ˜¯è¿™ä¸ªå¯¹è±¡æœ¬èº«ï¼Œå°±æ¯”å¦‚è¯´ï¼Œæˆ‘ä»¬å‘é‚®ä»¶ï¼Œé€šè¿‡ä»£ç†æ¨¡å¼ï¼Œé‚£ä¹ˆä»£ç†è€…å¯ä»¥æ§åˆ¶ï¼Œå†³å®šå‘è¿˜æ˜¯ä¸å‘ï¼Œä½†å…·ä½“å‘çš„æ‰§è¡ŒåŠŸèƒ½ï¼Œæ˜¯å¤–éƒ¨å¯¹è±¡æ‰€å†³å®šï¼Œè€Œä¸æ˜¯ä»£ç†è€…å†³å®šã€‚

#### ä¸€äº›ä¾‹å­

- äº‹ä»¶å§”æ‰˜ï¼Œäº‹ä»¶ä»£ç†
- Object.defineProperty /Proxy
- è™šæ‹Ÿä»£ç†å®ç°å›¾ç‰‡æ‡’åŠ è½½
- http è¯·æ±‚ç¼“å­˜ä»£ç†

#### å®æˆ˜

- è™šæ‹Ÿä»£ç†å®ç°å›¾ç‰‡æ‡’åŠ è½½

  æ­£å¸¸åŠ è½½

  ```typescript
  const myImage = (function() {
    const imgNode = document.createElement('img');
    document.body.appendChild(imgNode);
    return {
      setSrc: function(src: string) {
        imgNode.src = src;
      },
    };
  })();

  myImage.setSrc(
    'https://pic4.zhimg.com/v2-13f1954ad4ddb46d032b371cc1887469_im.jpg?source=32738c0c 2x',
  );
  ```

  æ­£å¸¸æ‡’åŠ è½½

  ```typescript
  const MyImage = (function() {
    const imgNode = document.createElement('img');
    document.body.appendChild(imgNode);
    const img = new Image();
    img.onload = function() {
      imgNode.src = img.src;
    };
    return {
      setSrc: function(src: string) {
        imgNode.src = pp;
        setTimeout(() => {
          img.src = src;
        }, 1000);
      },
    };
  })();
  MyImage.setSrc(
    'https://pic4.zhimg.com/v2-13f1954ad4ddb46d032b371cc1887469_im.jpg?source=32738c0c2x',
  );
  ```

  è™šæ‹Ÿä»£ç†å®ç°æ‡’åŠ è½½

  > åœ¨ å¸¸è§„å¼€å‘ä¸­ï¼Œå›¾ç‰‡é¢„åŠ è½½æ˜¯ä¸€ç§å¸¸ç”¨çš„æŠ€æœ¯ï¼Œå¦‚æœç›´æ¥ç»™æŸä¸ª img æ ‡ç­¾èŠ‚ç‚¹è®¾ç½® src å±æ€§ï¼Œç”±äºå›¾ç‰‡è¿‡å¤§æˆ–è€…ç½‘ç»œä¸ä½³ï¼Œå›¾ç‰‡çš„ä½ç½®å¾€å¾€æœ‰æ®µæ—¶é—´ä¼šæ˜¯ä¸€ç‰‡ç©ºç™½ã€‚å¸¸è§çš„åšæ³•æ˜¯å…ˆç”¨ä¸€å¼  loading å›¾ç‰‡å ä½ï¼Œç„¶åç”¨å¼‚æ­¥çš„æ–¹å¼åŠ è½½å›¾ç‰‡ï¼Œç­‰å›¾ç‰‡åŠ è½½å¥½äº†å†æŠŠå®ƒå¡«å……åˆ° img èŠ‚ç‚¹é‡Œï¼Œè¿™ç§åœºæ™¯å°±å¾ˆé€‚åˆä½¿ç”¨è™šæ‹Ÿä»£ç†ã€‚

  ```typescript
  const createImage = (function() {
    const img = document.createElement('img');
    img.width = 100;
    img.height = 100;
    document.body.appendChild(img);

    return function(src: string) {
      img.src = src;
    };
  })();

  const proxyImage = function(fn: (src: string) => void) {
    const image = new Image();
    const defaultImg = pp;

    return function(src: string) {
      fn(defaultImg);

      // è¿™é‡ŒåŠ ä¸€ä¸ªå»¶è¿Ÿï¼Œå¯ä»¥æ›´å¥½çš„çœ‹åˆ°å›¾ç‰‡æ›¿æ¢çš„è¿‡ç¨‹ã€‚

      setTimeout(function() {
        image.src = src;

        image.onload = function() {
          fn(src);
        };
      }, 2000);
    };
  };

  const proxy = proxyImage(createImage);

  proxy(
    'https://pic4.zhimg.com/v2-13f1954ad4ddb46d032b371cc1887469_im.jpg?source=32738c0c2x',
  );
  ```

  è¿™é‡Œå¹¶æ²¡æœ‰æ”¹å˜ createImageï¼Œåªæ˜¯åœ¨æ­¤åŸºç¡€ä¸Šæ–°å¢äº†æ–°çš„è¡Œä¸ºï¼Œè¿™æ˜¯ç¬¦åˆå°é—­-å¼€æ”¾åŸåˆ™çš„ã€‚å³ä½¿åœ¨åç»­ä¸éœ€è¦æ‡’åŠ è½½åŠŸèƒ½ï¼Œæˆ–è€…è‹¥å¹²å¹´åç½‘é€Ÿä¸åœ¨æ˜¯é—®é¢˜ï¼Œé‚£æˆ‘ä»¬ä¹Ÿåªéœ€è¦å»æ‰ä»£ç†å±‚å³å¯ã€‚ç»™ img èŠ‚ç‚¹è®¾ç½® src å’Œå›¾ç‰‡é¢„åŠ è½½è¿™ä¸¤ä¸ªåŠŸèƒ½ï¼Œè¢«éš”ç¦»åœ¨ä¸¤ä¸ªå¯¹è±¡é‡Œï¼Œå®ƒä»¬å¯ä»¥å„è‡ªå˜åŒ–è€Œä¸å½±å“å¯¹æ–¹ã€‚

- http è¯·æ±‚ç¼“å­˜ä»£ç†

  > ç¼“å­˜ä»£ç†å¯ä»¥ä¸ºä¸€äº›å¼€é”€å¤§çš„è¿ç®—ç»“æœæä¾›æš‚æ—¶çš„å­˜å‚¨ï¼Œåœ¨ä¸‹æ¬¡è¿ç®—æ—¶ï¼Œå¦‚æœä¼ é€’è¿›æ¥çš„å‚æ•°è·Ÿä¹‹å‰ä¸€è‡´ï¼Œåˆ™å¯ä»¥ç›´æ¥è¿”å›å‰é¢å­˜å‚¨çš„è¿ç®—ç»“æœã€‚

  - è®¡ç®—ä¹˜ç§¯

    ```typescript
    function mult() {
      let count = 1;
      for (let i = 0, l = arguments.length; i < l; i++) {
        count = count * arguments[i];
      }
      return count;
    }
    ```

    åŠ å…¥ç¼“å­˜ä»£ç†å‡½æ•°

    ```typescript
    const proxyMult = (function() {
      let cache: Record<string, any> = {};
      return function() {
        var args = Array.prototype.join.call(arguments, ',');
        if (args in cache) {
          return cache[args];
        }
        return (cache[args] = mult.apply(this, arguments));
      };
    })();

    proxyMult(1, 2, 34, 5, 6, 7, 8);
    proxyMult(1, 2, 34, 5, 6, 7, 8);
    ```

    å½“æˆ‘ä»¬ç¬¬äºŒæ¬¡è°ƒç”¨ proxyMult( 1, 2, 3, 4 )çš„æ—¶å€™ï¼Œæœ¬ä½“ mult å‡½æ•°å¹¶æ²¡æœ‰è¢«è®¡ç®—ï¼ŒproxyMult ç›´æ¥è¿”å›äº†ä¹‹å‰ç¼“å­˜å¥½çš„è®¡ç®—ç»“æœã€‚

    é€šè¿‡å¢åŠ ç¼“å­˜ä»£ç†çš„æ–¹å¼ï¼Œmult å‡½æ•°å¯ä»¥ç»§ç»­ä¸“æ³¨äºè‡ªèº«çš„èŒè´£â€”â€”è®¡ç®—ä¹˜ç§¯ï¼Œç¼“å­˜çš„åŠŸèƒ½æ˜¯ç”±ä»£ç†å¯¹è±¡å®ç°çš„ã€‚

  - ç¼“å­˜ä»£ç†ç”¨äº ajax å¼‚æ­¥è¯·æ±‚æ•°æ®

    æˆ‘ä»¬åœ¨å¸¸å¸¸åœ¨é¡¹ç›®ä¸­é‡åˆ°åˆ†é¡µçš„éœ€æ±‚ï¼ŒåŒä¸€é¡µçš„æ•°æ®ç†è®ºä¸Šåªéœ€è¦å»åå°æ‹‰å–ä¸€æ¬¡ï¼Œè¿™äº›å·²ç»æ‹‰å–åˆ°çš„æ•°æ®åœ¨æŸä¸ªåœ°æ–¹è¢«ç¼“å­˜ä¹‹åï¼Œä¸‹æ¬¡å†è¯·æ±‚åŒä¸€é¡µçš„æ—¶å€™ï¼Œä¾¿å¯ä»¥ç›´æ¥ä½¿ç”¨ä¹‹å‰çš„æ•°æ®ã€‚æ˜¾ç„¶è¿™é‡Œä¹Ÿå¯ä»¥å¼•å…¥ç¼“å­˜ä»£ç†ï¼Œå®ç°æ–¹å¼è·Ÿè®¡ç®—ä¹˜ç§¯çš„ä¾‹å­å·®ä¸å¤šï¼Œå”¯ä¸€ä¸åŒçš„æ˜¯ï¼Œè¯·æ±‚æ•°æ®æ˜¯ä¸ªå¼‚æ­¥çš„æ“ä½œï¼Œæˆ‘ä»¬æ— æ³•ç›´æ¥æŠŠè®¡ç®—ç»“æœæ”¾åˆ°ä»£ç†å¯¹è±¡çš„ç¼“å­˜ä¸­ï¼Œè€Œæ˜¯è¦é€šè¿‡å›è°ƒçš„æ–¹å¼ã€‚æœ‰å…´è¶£çš„å¯è‡ªè¡Œ coding è¯•è¯•

#### ä»€ä¹ˆæ—¶å€™ä½¿ç”¨

åœ¨ JavaScript å¼€å‘ä¸­æœ€å¸¸ç”¨çš„æ˜¯è™šæ‹Ÿä»£ç†å’Œç¼“å­˜ä»£ç†ã€‚è™½ç„¶ä»£ç†æ¨¡å¼éå¸¸æœ‰ç”¨ï¼Œä½†æˆ‘ä»¬åœ¨ç¼–å†™ä¸šåŠ¡ä»£ç çš„æ—¶å€™ï¼Œå¾€å¾€ä¸éœ€è¦å»é¢„å…ˆçŒœæµ‹æ˜¯å¦éœ€è¦ä½¿ç”¨ä»£ç†æ¨¡å¼ã€‚å½“çœŸæ­£å‘ç°ä¸æ–¹ä¾¿ç›´æ¥è®¿é—®æŸä¸ªå¯¹è±¡çš„æ—¶å€™ï¼Œå†ç¼–å†™ä»£ç†ä¹Ÿä¸è¿Ÿ

- æ¨¡å—èŒè´£å•ä¸€ä¸”å¯å¤ç”¨
- ä¸¤ä¸ªæ¨¡å—é—´çš„äº¤äº’éœ€è¦ä¸€å®šé™åˆ¶å…³ç³»
- å¯¹å¼€é”€å¤§çš„å¯¹è±¡ä½¿ç”¨ä»£ç†ï¼Œä»¥æŒ‰éœ€ä½¿ç”¨ã€‚
- å¯¹éœ€è¦ä¿æŠ¤çš„å¯¹è±¡è¿›è¡Œä»£ç†ï¼Œåœ¨ä»£ç†å±‚åšæƒé™æ§åˆ¶
- åœ¨å¯¹è±¡è®¿é—®ä¸ä¿®æ”¹æ—¶è¦æ‰§è¡Œä¸€äº›å…¶ä»–é€»è¾‘ï¼Œé€‚åˆåœ¨ä»£ç†å±‚åšã€‚

#### å¼Šç«¯

- ä»£ç†æ¨¡å¼ä¼šå¢åŠ å¾®å¼±çš„å¼€é”€ï¼Œå› æ­¤è¯·ä¸è¦å°†æ‰€æœ‰å¯¹è±¡éƒ½å˜æˆä»£ç†ï¼Œæ²¡æœ‰æ„ä¹‰çš„ä»£ç†åªä¼šå¾’å¢ç¨‹åºå¼€é”€ã€‚
- å¦å¤–ä»£ç†å¯¹è±¡è¿‡å¤šï¼Œä¹Ÿä¼šå¯¼è‡´è°ƒè¯•å›°éš¾ï¼Œå› ä¸ºä»£ç†å±‚çš„å­˜åœ¨ï¼Œæˆ‘ä»¬å¾€å¾€å¯èƒ½å¿½ç•¥è¿™ä¸€å±‚å¸¦æ¥çš„å½±å“ï¼Œå¯¼è‡´å¿˜è®°è¿™ä¸ªå¯¹è±¡å…¶å®æ˜¯ä¸€ä¸ªä»£ç†ã€‚

#### è£…é¥°å™¨æ¨¡å¼å’Œä»£ç†æ¨¡å¼çš„åŒºåˆ«

è¿™ä¸¤ç§æ¨¡å¼éƒ½æè¿°äº†æ€æ ·ä¸ºå¯¹è±¡æä¾›ä¸€å®šç¨‹åº¦ä¸Šçš„é—´æ¥å¼•ç”¨ï¼Œå®ƒä»¬çš„å®ç°éƒ¨åˆ†éƒ½ä¿ç•™äº†å¯¹å¦å¤–ä¸€ä¸ªå¯¹è±¡çš„å¼•ç”¨ï¼Œå¹¶ä¸”å‘é‚£ä¸ªå¯¹è±¡å‘é€è¯·æ±‚ã€‚

â€‹ ä»£ç†æ¨¡å¼å’Œè£…é¥°è€…æ¨¡å¼æœ€é‡è¦çš„åŒºåˆ«åœ¨äºå®ƒä»¬çš„æ„å›¾å’Œè®¾è®¡ç›®çš„ã€‚ä»£ç†æ¨¡å¼çš„ç›®çš„æ˜¯ï¼Œå½“ç›´æ¥è®¿é—®æœ¬ä½“ä¸æ–¹ä¾¿æˆ–è€…ä¸ç¬¦åˆéœ€è¦æ—¶ï¼Œä¸ºè¿™ä¸ªæœ¬ä½“æä¾›ä¸€ä¸ªæ›¿ä»£è€…ã€‚æœ¬ä½“å®šä¹‰äº†å…³é”®åŠŸèƒ½ï¼Œè€Œä»£ç†æä¾›æˆ–æ‹’ç»å¯¹å®ƒçš„è®¿é—®ï¼Œæˆ–è€…åœ¨è®¿é—®æœ¬ä½“ä¹‹å‰åšä¸€äº›é¢å¤–çš„äº‹æƒ…ã€‚è£…é¥°è€…æ¨¡å¼çš„ä½œç”¨å°±æ˜¯ä¸ºå¯¹è±¡åŠ¨æ€åŠ å…¥è¡Œä¸ºã€‚æ¢å¥è¯è¯´ï¼Œä»£ç†æ¨¡å¼å¼ºè°ƒä¸€ç§å…³ç³»ï¼ˆProxy ä¸å®ƒçš„å®ä½“ä¹‹é—´çš„å…³ç³»ï¼‰ï¼Œè¿™ç§å…³ç³»å¯ä»¥é™æ€çš„è¡¨è¾¾ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™ç§å…³ç³»åœ¨ä¸€å¼€å§‹å°±å¯ä»¥è¢«ç¡®å®šã€‚è€Œè£…é¥°è€…æ¨¡å¼ç”¨äºä¸€å¼€å§‹ä¸èƒ½ç¡®å®šå¯¹è±¡çš„å…¨éƒ¨åŠŸèƒ½æ—¶ã€‚ä»£ç†æ¨¡å¼é€šå¸¸åªæœ‰ä¸€å±‚ä»£ç† ï€­ æœ¬ä½“çš„å¼•ç”¨ï¼Œè€Œè£…é¥°è€…æ¨¡å¼ç»å¸¸ä¼šå½¢æˆä¸€æ¡é•¿é•¿çš„è£…é¥°é“¾ã€‚

â€‹ åœ¨è™šæ‹Ÿä»£ç†å®ç°å›¾ç‰‡é¢„åŠ è½½çš„ä¾‹å­ä¸­ï¼Œæœ¬ä½“è´Ÿè´£è®¾ç½® img èŠ‚ç‚¹çš„ srcï¼Œä»£ç†åˆ™æä¾›äº†é¢„åŠ è½½çš„åŠŸèƒ½ï¼Œè¿™çœ‹èµ·æ¥ä¹Ÿæ˜¯â€œåŠ å…¥è¡Œä¸ºâ€çš„ä¸€ç§æ–¹å¼ï¼Œä½†è¿™ç§åŠ å…¥è¡Œä¸ºçš„æ–¹å¼å’Œè£…é¥°è€…æ¨¡å¼çš„åé‡ç‚¹æ˜¯ä¸ä¸€æ ·çš„ã€‚è£…é¥°è€…æ¨¡å¼æ˜¯å®å®åœ¨åœ¨çš„ä¸ºå¯¹è±¡å¢åŠ æ–°çš„èŒè´£å’Œè¡Œä¸ºï¼Œè€Œä»£ç†åšçš„äº‹æƒ…è¿˜æ˜¯è·Ÿæœ¬ä½“ä¸€æ ·ï¼Œæœ€ç»ˆéƒ½æ˜¯è®¾ç½® srcã€‚ä½†ä»£ç†å¯ä»¥åŠ å…¥ä¸€äº›â€œèªæ˜â€çš„åŠŸèƒ½ï¼Œæ¯”å¦‚åœ¨å›¾ç‰‡çœŸæ­£åŠ è½½å¥½ä¹‹å‰ï¼Œå…ˆä½¿ç”¨ä¸€å¼ å ä½çš„ loading å›¾ç‰‡åé¦ˆç»™å®¢æˆ·ã€‚

### å‘å¸ƒè®¢é˜…æ¨¡å¼

> å‘å¸ƒ-è®¢é˜…æ˜¯ä¸€ç§æ¶ˆæ¯èŒƒå¼ï¼Œæ¶ˆæ¯çš„å‘å¸ƒè€…ï¼Œä¸ä¼šå°†æ¶ˆæ¯ç›´æ¥å‘é€ç»™ç‰¹å®šçš„è®¢é˜…è€…ï¼Œè€Œæ˜¯é€šè¿‡æ¶ˆæ¯é€šé“å¹¿æ’­å‡ºå»ï¼Œç„¶åå‘¢ï¼Œè®¢é˜…è€…é€šè¿‡è®¢é˜…è·å–åˆ°æƒ³è¦çš„æ¶ˆæ¯ã€‚

#### ä¸€äº›ä¾‹å­

- DOM äº‹ä»¶
- RN ä¸ app ä¹‹é—´æ•°æ®çš„ä¼ é€’ä¼šç”¨çš„æ¯”è¾ƒé¢‘ç¹ï¼Œå¦‚ç›‘å¬è®¾å¤‡å˜æ›´ï¼Œç½‘ç»œçŠ¶æ€ï¼Œè“ç‰™çŠ¶æ€ç­‰ç­‰
- RN ä¸­çš„ DeviceEnentEmitter
- Vue ä¸­çš„ vm.$on,vm.$emit,vm.\$once

#### å®æˆ˜

å®ç°ä¸€ä¸ªé€šç”¨çš„å‘å¸ƒè®¢é˜…

```typescript
const EventEmit = function() {
  this.events = {};
  this.on = function(name, cb) {
    if (this.events[name]) {
      this.events[name].push(cb);
    } else {
      this.events[name] = [cb];
    }
  };
  this.trigger = function(name, ...arg) {
    if (this.events[name]) {
      this.events[name].forEach(eventListener => {
        eventListener(...arg);
      });
    }
  };
};
```

#### ä»€ä¹ˆæ—¶å€™ä½¿ç”¨

- å„æ¨¡å—ç›¸äº’ç‹¬ç«‹
- å­˜åœ¨ä¸€å¯¹å¤šçš„ä¾èµ–å…³ç³»
- ä¾èµ–æ¨¡å—ä¸ç¨³å®šã€ä¾èµ–å…³ç³»ä¸ç¨³å®š
- å„æ¨¡å—ç”±ä¸åŒçš„äººå‘˜ã€å›¢é˜Ÿå¼€å‘

#### ä¼˜ç‚¹

â€‹ å®ƒçš„åº”ç”¨éå¸¸å¹¿æ³›ï¼Œæ—¢å¯ä»¥ç”¨åœ¨å¼‚æ­¥ç¼–ç¨‹ä¸­ï¼Œä¹Ÿå¯ä»¥å¸®åŠ©æˆ‘ä»¬å®Œæˆæ›´æ¾è€¦åˆçš„ä»£ç ç¼–å†™ã€‚å‘å¸ƒâ€”è®¢é˜…æ¨¡å¼è¿˜å¯ä»¥ç”¨æ¥å¸®åŠ©å®ç°ä¸€äº›åˆ«çš„è®¾è®¡æ¨¡å¼ï¼Œæ¯”å¦‚ä¸­ä»‹è€…æ¨¡å¼ã€‚ä»æ¶æ„ä¸Šæ¥çœ‹ï¼Œæ— è®ºæ˜¯ MVC è¿˜æ˜¯ MVVMï¼Œéƒ½å°‘ä¸äº†å‘å¸ƒâ€”è®¢é˜…æ¨¡å¼çš„å‚ä¸ï¼Œè€Œä¸” JavaScript æœ¬èº«ä¹Ÿæ˜¯ä¸€é—¨åŸºäºäº‹ä»¶é©±åŠ¨çš„è¯­è¨€ã€‚

- æ—¶é—´ä¸Šçš„è§£è€¦
- å¯¹è±¡é—´çš„è§£è€¦

#### å¼Šç«¯

â€‹ å½“ç„¶ï¼Œå‘å¸ƒâ€”è®¢é˜…æ¨¡å¼ä¹Ÿä¸æ˜¯å®Œå…¨æ²¡æœ‰ç¼ºç‚¹ã€‚åˆ›å»ºè®¢é˜…è€…æœ¬èº«è¦æ¶ˆè€—ä¸€å®šçš„æ—¶é—´å’Œå†…å­˜ï¼Œè€Œä¸”å½“ä½ è®¢é˜…ä¸€ä¸ªæ¶ˆæ¯åï¼Œä¹Ÿè®¸æ­¤æ¶ˆæ¯æœ€åéƒ½æœªå‘ç”Ÿï¼Œä½†è¿™ä¸ªè®¢é˜…è€…ä¼šå§‹ç»ˆå­˜åœ¨äºå†…å­˜ä¸­ã€‚å¦å¤–ï¼Œå‘å¸ƒâ€”è®¢é˜…æ¨¡å¼è™½ç„¶å¯ä»¥å¼±åŒ–å¯¹è±¡ä¹‹é—´çš„è”ç³»ï¼Œä½†å¦‚æœè¿‡åº¦ä½¿ç”¨çš„è¯ï¼Œå¯¹è±¡å’Œå¯¹è±¡ä¹‹é—´çš„å¿…è¦è”ç³»ä¹Ÿå°†è¢«æ·±åŸ‹åœ¨èƒŒåï¼Œä¼šå¯¼è‡´ç¨‹åºéš¾ä»¥è·Ÿè¸ªç»´æŠ¤å’Œç†è§£ã€‚ç‰¹åˆ«æ˜¯æœ‰å¤šä¸ªå‘å¸ƒè€…å’Œè®¢é˜…è€…åµŒå¥—åˆ°ä¸€èµ·çš„æ—¶å€™ï¼Œè¦è·Ÿè¸ªä¸€ä¸ª bug ä¸æ˜¯ä»¶è½»æ¾çš„äº‹æƒ…ã€‚

### é€‚é…å™¨æ¨¡å¼

> é€‚é…å™¨æ¨¡å¼çš„ä½œç”¨æ˜¯è§£å†³ä¸¤ä¸ªè½¯ä»¶å®ä½“é—´çš„æ¥å£ä¸å…¼å®¹çš„é—®é¢˜ã€‚ä½¿ç”¨é€‚é…å™¨æ¨¡å¼ä¹‹åï¼ŒåŸæœ¬ç”±äºæ¥å£ä¸å…¼å®¹è€Œä¸èƒ½å·¥ä½œçš„ä¸¤ä¸ªè½¯ä»¶å®ä½“å¯ä»¥ä¸€èµ·å·¥ä½œé€‚é…å™¨çš„åˆ«åæ˜¯åŒ…è£…å™¨ï¼ˆwrapperï¼‰ï¼Œè¿™æ˜¯ä¸€ä¸ªç›¸å¯¹ç®€å•çš„æ¨¡å¼ã€‚åœ¨ç¨‹åºå¼€å‘ä¸­æœ‰è®¸å¤šè¿™æ ·çš„åœºæ™¯ï¼šå½“æˆ‘ä»¬è¯•å›¾è°ƒç”¨æ¨¡å—æˆ–è€…å¯¹è±¡çš„æŸä¸ªæ¥å£æ—¶ï¼Œå´å‘ç°è¿™ä¸ªæ¥å£çš„æ ¼å¼å¹¶ä¸ç¬¦åˆç›®å‰çš„éœ€æ±‚ã€‚è¿™æ—¶å€™æœ‰ä¸¤ç§è§£å†³åŠæ³•ï¼Œç¬¬ä¸€ç§æ˜¯ä¿®æ”¹åŸæ¥çš„æ¥å£å®ç°ï¼Œä½†å¦‚æœåŸæ¥çš„æ¨¡å—å¾ˆå¤æ‚ï¼Œæˆ–è€…æˆ‘ä»¬æ‹¿åˆ°çš„æ¨¡å—æ˜¯ä¸€æ®µåˆ«äººç¼–å†™çš„ç»è¿‡å‹ç¼©çš„ä»£ç ï¼Œä¿®æ”¹åŸæ¥å£å°±æ˜¾å¾—ä¸å¤ªç°å®äº†ã€‚ç¬¬äºŒç§åŠæ³•æ˜¯åˆ›å»ºä¸€ä¸ªé€‚é…å™¨ï¼Œå°†åŸæ¥å£è½¬æ¢ä¸ºå®¢æˆ·å¸Œæœ›çš„å¦ä¸€ä¸ªæ¥å£ï¼Œå®¢æˆ·åªéœ€è¦å’Œé€‚é…å™¨æ‰“äº¤é“ã€‚

#### ä¸€äº›ä¾‹å­ ğŸŒ°

- ç”µæºé€‚é…å™¨
- USB è½¬æ¥å£
- å¤šåŠŸèƒ½æ’æ’

#### å®æˆ˜

æœ‰ä¸€ä¸ªé€šç”¨çš„ list ç»„ä»¶ï¼Œå¤šä¸ªé¡µé¢éƒ½éœ€è¦ç”¨åˆ°è¿™ä¸ªç»„ä»¶ï¼Œä½†æ˜¯å‘¢ï¼Œäº‘ç«¯è¿”å›çš„æ•°æ®ä¸¢ä¸ä¸€æ ·ï¼Œæˆ‘åªæƒ³è®©æˆ‘çš„ç»„ä»¶åªè´Ÿè´£ä¸€ä»¶äº‹ï¼šå±•ç¤ºï¼

æ¯ä¸ªæ¥å£å‘¢æ•°æ®æ ¼å¼éƒ½ä¸ä¸€æ ·

æ¥å£ A

```typescript
export interface ResourceLocalFileType {
  uuid: string;
  name: string;
  size: number;
  created: number;
  lastModified: number;
  resourceType: number;
  cancel: () => void;
  status: string;
}
```

æ¥å£ B

```typescript
export interface ResourcePackageFileType {
  uuid: string;
  materialName: string;
  materialLink: string;
  materialType: number;
  uid?: string;
  ext?: string;
}
```

æ¥å£ C

```typescript
export interface ResourcePackageFileType {
  uuid: string;
  materialName: string;
  materialLink: string;
  materialType: number;
  uid?: string;
  ext?: string;
}
```

æˆ‘çš„ç»„ä»¶å‘¢åªæ”¯æŒä¸€ç§æ•°æ®ç»“æ„ï¼Œè¿™æ—¶å€™å°±å¯ä»¥ä½¿ç”¨é€‚é…å™¨æ¨¡å¼

å…ˆç»Ÿä¸€ç»„ä»¶éœ€è¦æ¥å£çš„æ•°æ®æºæ ¼å¼

```typescript
export interface AdapterResourceType {
  uuid: string;
  created: number;
  fileNo: number;
  fileName: string;
  fileOrigin: string;
  fileStatus: string;
  fileInfo: {
    type: number;
    size?: number;
    [key: string]: any;
  };
  action?: {
    cancel?: () => void;
    [key: string]: any;
  };
}
```

é€‚é…å™¨

```typescript
const Adapter = {
  A:(list:ResourceLocalFileType):AdapterResourceType => {
    return list.map(d => {...//é€»è¾‘})
  },
  B:(list:ResourcePackageFileType):AdapterResourceType => {
    return list.map(d => {...//é€»è¾‘})
  },
  B:(list:ResourcePackageFileType):AdapterResourceType => {
    return list.map(d => {...//é€»è¾‘})
  },
}
```

è¿™å°±æ˜¯é€‚é…å™¨æ¨¡å¼ï¼Œå…¶å®æˆ‘ä»¬ç»å¸¸å†™ã€‚ã€‚ã€‚

#### å¼Šç«¯

â€‹ æ­£å¸¸å¼€å‘ä¸­ï¼Œé™¤éä¸‡ä¸å¾—å·²ï¼Œä¸ç„¶æ˜¯ä¸æ¨èä½¿ç”¨é€‚é…å™¨æ¨¡å¼çš„ã€‚é€‚é…å™¨æ¨¡å¼æ˜¯ä¸€ç§â€œäº¡ç¾Šè¡¥ç‰¢â€çš„æ¨¡å¼ã€‚ä½†æ˜¯å¾€å¾€ä¸šåŠ¡å¼€å‘è¿‡ç¨‹ä¸­æˆ‘ä»¬éœ€è¦é€‚é…å„ç§å„æ ·çš„ä¸šåŠ¡éœ€æ±‚ã€‚

â€‹ é€‚é…å™¨æ¨¡å¼æ˜¯ä¸€å¯¹ç›¸å¯¹ç®€å•çš„æ¨¡å¼ã€‚åœ¨æœ¬ä¹¦æåˆ°çš„è®¾è®¡æ¨¡å¼ä¸­ï¼Œæœ‰ä¸€äº›æ¨¡å¼è·Ÿé€‚é…å™¨æ¨¡å¼çš„ç»“æ„éå¸¸ç›¸ä¼¼ï¼Œæ¯”å¦‚è£…é¥°è€…æ¨¡å¼ã€ä»£ç†æ¨¡å¼å’Œå¤–è§‚æ¨¡å¼ã€‚è¿™å‡ ç§æ¨¡å¼éƒ½å±äºâ€œåŒ…è£…æ¨¡å¼â€ï¼Œéƒ½æ˜¯ç”±ä¸€ä¸ªå¯¹è±¡æ¥åŒ…è£…å¦ä¸€ä¸ªå¯¹è±¡ã€‚åŒºåˆ«å®ƒä»¬çš„å…³é”®ä»ç„¶æ˜¯æ¨¡å¼çš„æ„å›¾ã€‚

- é€‚é…å™¨æ¨¡å¼ä¸»è¦ç”¨æ¥è§£å†³ä¸¤ä¸ªå·²æœ‰æ¥å£ä¹‹é—´ä¸åŒ¹é…çš„é—®é¢˜ï¼Œå®ƒä¸è€ƒè™‘è¿™äº›æ¥å£æ˜¯æ€æ ·å®ç°çš„ï¼Œä¹Ÿä¸è€ƒè™‘å®ƒä»¬å°†æ¥å¯èƒ½ä¼šå¦‚ä½•æ¼”åŒ–ã€‚é€‚é…å™¨æ¨¡å¼ä¸éœ€è¦æ”¹å˜å·²æœ‰çš„æ¥å£ï¼Œå°±èƒ½å¤Ÿä½¿å®ƒä»¬ååŒä½œç”¨ã€‚
- è£…é¥°è€…æ¨¡å¼å’Œä»£ç†æ¨¡å¼ä¹Ÿä¸ä¼šæ”¹å˜åŸæœ‰å¯¹è±¡çš„æ¥å£ï¼Œä½†è£…é¥°è€…æ¨¡å¼çš„ä½œç”¨æ˜¯ä¸ºäº†ç»™å¯¹è±¡å¢åŠ åŠŸèƒ½ã€‚è£…é¥°è€…æ¨¡å¼å¸¸å¸¸å½¢æˆä¸€æ¡é•¿çš„è£…é¥°é“¾ï¼Œè€Œé€‚é…å™¨æ¨¡å¼é€šå¸¸åªåŒ…è£…ä¸€æ¬¡ã€‚
- ä»£ç†æ¨¡å¼æ˜¯ä¸ºäº†æ§åˆ¶å¯¹å¯¹è±¡çš„è®¿é—®ï¼Œé€šå¸¸ä¹ŸåªåŒ…è£…ä¸€æ¬¡
- å¤–è§‚æ¨¡å¼çš„ä½œç”¨å€’æ˜¯å’Œé€‚é…å™¨æ¯”è¾ƒç›¸ä¼¼ï¼Œæœ‰äººæŠŠå¤–è§‚æ¨¡å¼çœ‹æˆä¸€ç»„å¯¹è±¡çš„é€‚é…å™¨ï¼Œä½†å¤–è§‚æ¨¡å¼æœ€æ˜¾è‘—çš„ç‰¹ç‚¹æ˜¯å®šä¹‰äº†ä¸€ä¸ªæ–°çš„æ¥å£ã€‚

### äº«å…ƒæ¨¡å¼

> äº«å…ƒï¼ˆflyweightï¼‰æ¨¡å¼æ˜¯ä¸€ç§ç”¨äºæ€§èƒ½ä¼˜åŒ–çš„æ¨¡å¼,äº«å…ƒæ¨¡å¼çš„æ ¸å¿ƒæ˜¯è¿ç”¨å…±äº«æŠ€æœ¯æ¥æœ‰æ•ˆæ”¯æŒå¤§é‡ç»†ç²’åº¦çš„å¯¹è±¡
>
> å¦‚æœç³»ç»Ÿä¸­å› ä¸ºåˆ›å»ºäº†å¤§é‡ç±»ä¼¼çš„å¯¹è±¡è€Œå¯¼è‡´å†…å­˜å ç”¨è¿‡é«˜ï¼Œäº«å…ƒæ¨¡å¼å°±éå¸¸æœ‰ç”¨äº†ã€‚åœ¨ JavaScript ä¸­ï¼Œæµè§ˆå™¨ç‰¹åˆ«æ˜¯ç§»åŠ¨ç«¯çš„æµè§ˆå™¨åˆ†é…çš„å†…å­˜å¹¶ä¸ç®—å¤šï¼Œå¦‚ä½•èŠ‚çœå†…å­˜å°±æˆäº†ä¸€ä»¶éå¸¸æœ‰æ„ä¹‰çš„äº‹æƒ…

### å•ä¾‹æ¨¡å¼

### å…¶ä»–æ¨¡å¼

- è¿­ä»£å™¨æ¨¡å¼
- å‘½ä»¤æ¨¡å¼
- ç»„åˆæ¨¡å¼
- æ¨¡æ¿æ–¹æ³•æ¨¡å¼
- èŒè´£é“¾æ¨¡å¼
- ç»ˆç»“è€…æ¨¡å¼
- çŠ¶æ€æ¨¡å¼

### å‚è€ƒé“¾æ¥

- https://hejialianghe.gitee.io/jsadvanced/designpattern.html#_4-1-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E6%A6%82%E8%AE%BA
- https://juejin.cn/post/6844904138707337229#heading-24
- https://zhuanlan.zhihu.com/p/111553641
- https://github.com/ascoders/weekly
- <a href='../../public/è®¾è®¡æ¨¡å¼/è®¾è®¡æ¨¡å¼.md'>è®¾è®¡æ¨¡å¼.md</a>
